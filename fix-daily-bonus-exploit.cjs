// –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —ç–∫—Å–ø–ª–æ–π—Ç —Å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–º –±–æ–Ω—É—Å–æ–º
const fs = require('fs');
const path = require('path');

console.log('üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —ç–∫—Å–ø–ª–æ–π—Ç —Å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–º–∏ –±–æ–Ω—É—Å–∞–º–∏...');

// –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Ca6aka
const ca6akaFile = './users/Ca6aka.json';
let ca6aka = JSON.parse(fs.readFileSync(ca6akaFile, 'utf8'));

console.log('Ca6aka streak –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:', ca6aka.dailyBonusStreak);
console.log('Ca6aka balance –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:', ca6aka.balance);

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π streak (–º–∞–∫—Å–∏–º—É–º 30 –¥–Ω–µ–π)
if (ca6aka.dailyBonusStreak > 30) {
  ca6aka.dailyBonusStreak = 7; // –†–µ–∞–ª—å–Ω—ã–π streak –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞
}

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–æ–Ω—É—Å–∞
const berlinTime = new Date(new Date().toLocaleString("en-US", {timeZone: "Europe/Berlin"}));
const today = berlinTime.toDateString();
ca6aka.dailyLoginBonus = today;
ca6aka.lastDailyBonus = new Date().toISOString();

console.log('Ca6aka streak –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:', ca6aka.dailyBonusStreak);
console.log('Ca6aka dailyLoginBonus —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞:', ca6aka.dailyLoginBonus);

fs.writeFileSync(ca6akaFile, JSON.stringify(ca6aka, null, 2));

// –ü—Ä–æ–≤–µ—Ä–∏–º –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
const usersDir = './users';
const userFiles = fs.readdirSync(usersDir).filter(f => f.endsWith('.json'));

userFiles.forEach(file => {
  const userPath = path.join(usersDir, file);
  const userData = JSON.parse(fs.readFileSync(userPath, 'utf8'));
  
  if (userData.dailyBonusStreak > 30) {
    console.log(`–ò—Å–ø—Ä–∞–≤–ª—è–µ–º ${userData.nickname}: streak ${userData.dailyBonusStreak} -> 7`);
    userData.dailyBonusStreak = 7;
    userData.dailyLoginBonus = today;
    userData.lastDailyBonus = new Date().toISOString();
    fs.writeFileSync(userPath, JSON.stringify(userData, null, 2));
  }
});

console.log('‚úÖ –≠–∫—Å–ø–ª–æ–π—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω! –¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ —Å–º–æ–≥—É—Ç –ø–æ–ª—É—á–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –±–æ–Ω—É—Å—ã.');
console.log('‚úÖ –í—Å–µ streak —Å–±—Ä–æ—à–µ–Ω—ã –¥–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.');
console.log('‚úÖ –ü–æ–ª–µ dailyLoginBonus –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–æ–Ω—É—Å–∞.');